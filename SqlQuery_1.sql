DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Facturi.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '202006191730572_v1'
BEGIN
    CREATE TABLE [dbo].[Banci] (
        [Id] [int] NOT NULL IDENTITY,
        [Nume] [nvarchar](max),
        CONSTRAINT [PK_dbo.Banci] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Conturi] (
        [Id] [int] NOT NULL IDENTITY,
        [IBAN] [nvarchar](max),
        [Moneda] [nvarchar](max),
        [SoldInitial] [float],
        [DataDeschideriiContului] [datetime],
        [Sold] [float],
        [DataSold] [datetime],
        [BancaId] [int] NOT NULL,
        [CompanieId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Conturi] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_BancaId] ON [dbo].[Conturi]([BancaId])
    CREATE INDEX [IX_CompanieId] ON [dbo].[Conturi]([CompanieId])
    CREATE TABLE [dbo].[Companii] (
        [Id] [int] NOT NULL IDENTITY,
        [Nume] [nvarchar](max),
        [Email] [nvarchar](max),
        [Prioritate] [int],
        CONSTRAINT [PK_dbo.Companii] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Facturi] (
        [Id] [int] NOT NULL IDENTITY,
        [Valoare] [float] NOT NULL,
        [Moneda] [nvarchar](max),
        [DataEmitere] [datetime] NOT NULL,
        [DataScadenta] [datetime] NOT NULL,
        [FurnizorId] [int],
        [ClientId] [int],
        [Companie_Id] [int],
        CONSTRAINT [PK_dbo.Facturi] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_FurnizorId] ON [dbo].[Facturi]([FurnizorId])
    CREATE INDEX [IX_ClientId] ON [dbo].[Facturi]([ClientId])
    CREATE INDEX [IX_Companie_Id] ON [dbo].[Facturi]([Companie_Id])
    CREATE TABLE [dbo].[Tranzactii] (
        [Id] [int] NOT NULL IDENTITY,
        [ValoareFactura] [float] NOT NULL,
        [ValoareTotala] [float] NOT NULL,
        [Moneda] [nvarchar](max),
        [Data] [datetime] NOT NULL,
        [isProcesata] [bit] NOT NULL,
        [TipOperatiune] [nvarchar](max),
        [FacturaId] [int] NOT NULL,
        [ContFurnizorId] [int],
        [ContClientId] [int],
        CONSTRAINT [PK_dbo.Tranzactii] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_FacturaId] ON [dbo].[Tranzactii]([FacturaId])
    CREATE INDEX [IX_ContFurnizorId] ON [dbo].[Tranzactii]([ContFurnizorId])
    CREATE INDEX [IX_ContClientId] ON [dbo].[Tranzactii]([ContClientId])
    CREATE TABLE [dbo].[Costuri] (
        [Id] [int] NOT NULL IDENTITY,
        [Denumire] [nvarchar](max),
        [Valoare] [float] NOT NULL,
        [Moneda] [nvarchar](max),
        [TranzactieId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Costuri] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_TranzactieId] ON [dbo].[Costuri]([TranzactieId])
    CREATE TABLE [dbo].[Operatiuni] (
        [Id] [int] NOT NULL IDENTITY,
        [Denumire] [nvarchar](max),
        [isFix] [bit] NOT NULL,
        [CostFix] [float],
        [CostMinim] [float],
        [isPercentage] [bit] NOT NULL,
        [PercentageValue] [float],
        CONSTRAINT [PK_dbo.Operatiuni] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[TemplateExportBanci] (
        [Id] [int] NOT NULL IDENTITY,
        [NumeBanca] [nvarchar](max),
        [Template] [nvarchar](max),
        CONSTRAINT [PK_dbo.TemplateExportBanci] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[OperatiuneConts] (
        [Operatiune_Id] [int] NOT NULL,
        [Cont_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.OperatiuneConts] PRIMARY KEY ([Operatiune_Id], [Cont_Id])
    )
    CREATE INDEX [IX_Operatiune_Id] ON [dbo].[OperatiuneConts]([Operatiune_Id])
    CREATE INDEX [IX_Cont_Id] ON [dbo].[OperatiuneConts]([Cont_Id])
    ALTER TABLE [dbo].[Conturi] ADD CONSTRAINT [FK_dbo.Conturi_dbo.Banci_BancaId] FOREIGN KEY ([BancaId]) REFERENCES [dbo].[Banci] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Conturi] ADD CONSTRAINT [FK_dbo.Conturi_dbo.Companii_CompanieId] FOREIGN KEY ([CompanieId]) REFERENCES [dbo].[Companii] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Facturi] ADD CONSTRAINT [FK_dbo.Facturi_dbo.Companii_ClientId] FOREIGN KEY ([ClientId]) REFERENCES [dbo].[Companii] ([Id])
    ALTER TABLE [dbo].[Facturi] ADD CONSTRAINT [FK_dbo.Facturi_dbo.Companii_FurnizorId] FOREIGN KEY ([FurnizorId]) REFERENCES [dbo].[Companii] ([Id])
    ALTER TABLE [dbo].[Facturi] ADD CONSTRAINT [FK_dbo.Facturi_dbo.Companii_Companie_Id] FOREIGN KEY ([Companie_Id]) REFERENCES [dbo].[Companii] ([Id])
    ALTER TABLE [dbo].[Tranzactii] ADD CONSTRAINT [FK_dbo.Tranzactii_dbo.Conturi_ContClientId] FOREIGN KEY ([ContClientId]) REFERENCES [dbo].[Conturi] ([Id])
    ALTER TABLE [dbo].[Tranzactii] ADD CONSTRAINT [FK_dbo.Tranzactii_dbo.Conturi_ContFurnizorId] FOREIGN KEY ([ContFurnizorId]) REFERENCES [dbo].[Conturi] ([Id])
    ALTER TABLE [dbo].[Tranzactii] ADD CONSTRAINT [FK_dbo.Tranzactii_dbo.Facturi_FacturaId] FOREIGN KEY ([FacturaId]) REFERENCES [dbo].[Facturi] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[Costuri] ADD CONSTRAINT [FK_dbo.Costuri_dbo.Tranzactii_TranzactieId] FOREIGN KEY ([TranzactieId]) REFERENCES [dbo].[Tranzactii] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[OperatiuneConts] ADD CONSTRAINT [FK_dbo.OperatiuneConts_dbo.Operatiuni_Operatiune_Id] FOREIGN KEY ([Operatiune_Id]) REFERENCES [dbo].[Operatiuni] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[OperatiuneConts] ADD CONSTRAINT [FK_dbo.OperatiuneConts_dbo.Conturi_Cont_Id] FOREIGN KEY ([Cont_Id]) REFERENCES [dbo].[Conturi] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202006191730572_v1', N'Facturi.Migrations.Configuration',  0x1F8B0800000000000400ED5D4B6F1CB911BE07C87F68F42909BC1AC97BD918A35DD8921508B12DC3232F7213A8196A4CA41F93EE1E43DA20BF2C87FCA4FC85B05F6C36597CF573A40C7CB19A64B1582C168B55E437FFFDF77F96BF3C8681F71D272989A373FFECE4D4F770B48E3724DA9EFBFBECE1879FFC5F7EFEFDEF96EF37E1A3F76B5DEFC7BC1E6D19A5E7FEB72CDBBD592CD2F5371CA2F42424EB244EE387EC641D870BB48917AF4F4FFFBC383B5B604AC2A7B43C6FF9651F6524C4C51FF4CF8B385AE35DB647C1C7788383B4FA4E4B560555EF130A71BA436B7CEE5FA175B64F88EFBD0D08A2DDAF70F0E07B288AE20C6594B9375F53BCCA9238DAAE76F4030A6E9F7698D67B40418A2BA6DF34D56DF93F7D9DF3BF681AD6A4D6FB348B434782673F56025988CD3B89D56702A3227B4F459B3DE5A32EC476EEBF43D11AF99ED8D39B8B20C96B31919E14155F79D59FAFD87453ADC8FFBDF22EF6012DC1E711DE67090A5E799FF7F70159FF153FDDC67FC7D179B40F029E17CA0D2D6B7DA09F3E27F10E27D9D317FC507178BDF1BD45BBDD426CC89A716D4AF6AFA3ECC7D7BEF789768EEE03CCA69A1BEA2A8B13FC171CE1046578F31965194EA29C062E8425F52EF4F5691FE2BA37AA5B746DF8DE47F4F80147DBECDBB94FFFEB7B57E4116FEA2F15075F234297126D94257B2C75F2097D27DB823FA13BBA1C4A15FF8283A23CFD4676A5A69FE46577D58C5E2571F8250EAA16E5D7BB5B946C7146B98DA5A255BC4FD6021FCB45A32F5A2DCAE9D828515EEFA843405FEFDE7E1A5E87844E3EC611DEA0D1BB59C5C1E63A22B975ADFBBA8CE9341A1B5EA20C5D626AD3C8062784148A1EEC092342257B4B42ABFEDD3B6EB5B2ECA958386635D113B988C31D8A0876A6A3B4109501E8621F6A2300D887DA74D8DBA9725C0A46CAC2BB0F24CD1033693C4F4005C07C41B5204BA6E3B4687CB3CB972ED947B06565C56A96155524A655F53AB17D9BA0E8376A4E09B9BB0808CEADB06ADE55F5054580ABC19AA1A8EBAA2A2299AB7D1291DFE2C47E2C4D0BC368EA8A76E361B5A111396C8EF54AB0D920CBBAC74D722A474BE8E47D8848307A2F9F131227848A050BE2735A327A57B09385959785CE0E3B71CBCE66466E594D15B7550503B775AD5E8BB724627542AAAA1E97AEDCD7AF2888518245B7CCD1559AC881CDDDC1F721A123C4B247E8C872E15AAE512E26D49B58BD1D493367F0308B5DD9D448EDC8A9FD8A4AE30157A25D222D54A1D8D59E681D849A36E41388654AC6B43BBF832F0372C88AF11D332F0D8F72A9E44202557A1DDF1B7A3676AEA97D34754A53C726B697C5AB88DD52DE82BEB426B49EBD2D1D49E987354E395AEF62AAFA287226754B76CD896BF4D157D3DE3F2810655DAD3D6DDAD7E2331226F3C5D7042D58534132B5702DF7304323291B6EA15D4151C5C471E73DE2224E359E704A85C0D963DE076E1501D19076B96B408199AC21B62C8DECC45DADE3A13AB58C38A7C7883364A671B40F4932BE457C56AE7FA3A5C38563F9C5DC6FC1CBC75DD820745A50FC26695E564DEDE3E29A7171919492E8EB21E56AC491B1CB99E48D3E9288846ECDA86387A90ED3D3F016F7E5BBA1446DCC5EB2308385D27AC4FEC5156BCA11743BBDE1704799C6EF1F777192E5D91A62758C939B1DD7321C75AE5266636F3ED5840CDC914A8FDEA669BC26858C385FBA4A0FB6197D1F6D3C75AEB064B6CECD507EA9A6901DD50DDAE9B9FF2769D82035E6CC36D42AA9B7C99DF9A24ADD449738C019F6DEAECB2B361728CD236EB25AD18EDB5FA816E224570314505652AAD724CA6495257469EC50A0645A6861A9E639478CB65872897738CA355429779B4E59825AEE997520C8C82492E582D31B933A412908B52E68F311BC92D5E9B41135C3C417A0AE76CADF51E534B29944FB3432B0E99FBFE4308B2E0A916AD564ABC2D6CD2CB3D3AFBD955304BB2D54FAF4E4E46C180D827998407560895AE90C0B62CDAA312C60649A5E396C3488D64851A659F446E46242CD11E56AD3351F3B9D457BE018A96AAE0D01D366C2F93881BD2AE923AD862D6C385DD2B231814269A56CB78BF1A1F543D02BA3713286B607D62DBDB59A50BB6630580659DB6AD8ECB64B8C48AA3D634578929FF2D4F140A84871D8A8E9211C0D41F627F1D0C1B9B0E9B91DF39EDBAAD59E9285BD91524D03DA32E9E685D1979B5FFBD4EC4F6BFC8479B1F2D79AB4F901842AEAFB87762101E9326247FFDC44DF5E15051D7790832AD4ADE2D418F76E78E5F34BF64BD278A9DE29FEE2A411EA2BF3DA70A6E9FE7C077FC8AE07A7BD72B0C09471C4530547F5527926EEBDFE71839356E85CFDA1344FE7EDCFA37B5D9CEE31B4AFCBF16306E7BFCC0CE51DD3163869EDC6C5033CFC08DDB2F99AE22A9D98561927516D72B22B9C717908E27B4D1EAA9DE19194AEDD9AE55BA5F6A51E1B9B17BB29DCBEDE9F0D34D88B048904DB820D14F82BC112117EAD1847932A85919A85C13F739328F05BB4693850CE591E17544BA0CC69667BCAEB878A5C05F919A3B844B4994A36084EA7A445A6CD4E7214E0D12CDAC3B11A2AF850071AB5319DA6F12245CFAC258B7A816885A14B839925DB4132E2EB025924BAAC8E4D5E87639BAD708D0C14891C0B51F6187D7361553D7ED843B0CB52749481B4F58F2305C55D63591416017787903B3718DE706BE4A28FB18FB23E94379B8DD2B1D01753E0B8B784F40A34948CA4DB95905DD5843BAD029E2DCE538B7D050E725A89B49F9E306F45AB22600CCE360AD74B31C4B09BD938F5DE711BC820C38E0B46851CE242FD765C310A348A6494371D65D958458A9C6245DC88782F552321537068248BA2C15250F8AA367124E74852176FD6103A1ACB0219301B2CA566B16BD9454286909C6EFBEA24BBFA9A263B8CB3B2E5A2043AAB3E2C17173022DAF223DAED48B4E510D2AA2FDEAA8447BBF861E50E2116963416EB14401263DCB29EB238415B2C94E642DCE02B92A459FE3EF01EE577562F36A1544D083D280EA175677C74419EBFFA305AD7CEFFDF3ACE9F8067C8466C577424611EE829AE100B673FA09D9743D2A10025C075E58B38D887913AE0A46E5DC25EF0EDCB2F3285E542605C0A2049429112516D095BC95F6DFACD33504470DC27006E368EFC4B6CAE56FBE28B3D85FAF1124FA3FE664FA585ABC5936A15D8D353C26DF1B49595DCF8961976E554A6D27CB5A7C42E44F38494B7A4D574F8FBAC3C29DD3DD719D767E56D765BA05588B4CB2255359DDB50AA2854E03F3C89EA933D0D1EDA8727C47F3F18D5509F69CC9AA138255A2886B2E5387AC15EA0F224D8C7A9CD780B5D46B467ACC0D138328419C940B2127B8A7C0E8AA7A7CB4DA9A93519D596A154E659675B0B9CD7DE6539A82348162B42D778D445C10242C0DA50A4B62CA8D6782500D1BA688E65272F0F170A2D4C129E50ABC09E9E004CC253148A1C966E738FAAB572D5D7ABD4B4C47474DBCFD1A7AAF5541526417BFD6246EF29ED71BA49BB9D6EA066E3D881E6A97A6B6DB0AFCF759B6DDF6A6D2D2EED7DD7D9F48C8B79765135CE5EB82B9CAEF1A1AB5D0581D036C8C52717A3542120B4ED51F5D18D4E058A2052AA3E3B6D371C5282B0DF70250E2713112FA1753C110B0F66614097483A3968663A369E9A0D95F1CEB7D59D18F1900B5EA4D2D16AB0065AA6917D9D7EF6DB817130822166ECD4D10AA1A2E501348FF92B023D604A4F9691D5AC339AF0253F8E89AEFC292F1D76D64A2D5BD473DB90E216EB759A237130540ACB518B591167FD50E62D75FBA45055BD2742C166602A0CF9CD8E93C1511D405D0C19D3CE0A1D658EDC99A75CCA878955984162793121FFB5AC7251E69F0D9292536515DFA3BC7FCF23DFE7FEEA29CD707892573859FD23A813BE75858F54B51F709A955838FEEBD3B3D7C28F101DCE0F022DD2741300B93C0E520802819900CD87E42235E2F538C244F1B0F1D17794ACBFA1E40F217AFC234FC91E364792956C1E9EADA8F89FA17110954CA80DD7D78B14F073320FF44C99B9D231FCBACC864A3013A06A6DD9EBCD174FA42B23C28FD110F00799AEA30D7E3CF7FF59B479E35DFFEDAE6AF6CABB49A85CDE78A7DEBF06F8091BDBDE9B960E0CB8FFF0C6CB589D1D0D994CA8F51B17BD28C9BF63518C7C10BB0ABF047EAE9327C0A04AA6A2030A6AAF99037EE400B23C9D7FE4A0333119F6DAD698342D55C6C446302276B6B529ABDAF5EA9B3F2375B3A4772E1C74F9818017B51C0594FE6EAB1204E93F8805DE7B310238FCF7C47D5820067FAFD14938FBD646A26ED8D3E381F0F9EDD72ADFBA9FC190C1FE5DB870375A6E00ED2FC3588870CEBD34F7D01C0108F2DC5685F8B66338F0AABCD45193B8345777B32C007F773ABE4A38E09DA840B0E05D462465B1AC79EA85B6FD32945342BAEE67570434EB31426FBA18BDDD3498C2EB304A0398C330CD9ED0959BA56D35EEEDBA743A5F14CD06B0F29D70C7DB08ECD3A083B75F004D85F5AC7A93320A6EC98B45119F17317C3A6DD15CCF9F4F619E0BDAB793B218F0918448821BEAF3C14FBDFAAE3F30FBCF04B7FB38FB63CCFEECE8B56EC8DB56B6DA30F93CBCC4D40068D3427B3E17183D5794ECA3168CA205B3DB025B246BE7B91BCD734C453DB4C1CFEE89163C153EF50B44A376D8F7475299B9CC8E8B4F30ADE5799E58D2472F74D03388FE8AF5045AE0721B188434B204CF1EC9AC089155989711E31ADAE74C83AB96FEAE37D8A3F15EF68C3A06DDE676F5765FA85E4DE52D77D028CD2DFAB990C78F87E7FFC3C3B303F6DA51175ED8115A7872C31811B1DBC41994E1DE911AEEBD7C5C73EE6FEE633ACF65FE1046D31609973A25D12D3F436455B08F32E1DAE10688D74570070AA863B107E6874B1DB01288BE0ADB5324CFAF11A907BE10EA448357280B2A85672055CE000888AB06A68706C017429DB0720B417507AE0745678170AF1EAA429FC50ADA21177552A9D3B160F55B6B9B034394AD93B837704D2EA0DF6D3840E87C08B417781C3DC15007C4C2EF3E38C186B59E520F37C48100EF0F7598A321DA5BA99ED2DFE2DA697E8DE4C040EA0F73C88362CE3B330C24145A02027E24E62020E51D56DD0C333A3262FCA1192943F4D21E0F5E817EA088787263E13F6BC400FB521080C37842A911C0ED8502C32DF4326C530A42172B1A1402FF106DFB8448F6F30DDF018C5E06D9582EBEECA3FCB959F9D7254EC9B62191A3C54478DD8A3CB03AD7D1435C0742048EEA2AE24B189CA10DCAD0DB24230F7498E57BB594445BDF2BDE00E4CF9DEFF1E63ABAD967BB7D46878CC3FBE08917461E48D1F55F20EEB7795EDEECF2BFD2218640D924F90BBD9BE8DD9EE4400015DF57C09D6A05893C4253BD04C8E732CB5F046C9F18A54FB1684655842AF1B1C0527DBE4D6FA215FA8EBBF0F635C51FF016AD9F6AAC143511F344B4C5BEBC24689BA030AD6834EDE99F548737E1E3CFFF03F7DD390DC8AE0000 , N'6.4.0')
END

